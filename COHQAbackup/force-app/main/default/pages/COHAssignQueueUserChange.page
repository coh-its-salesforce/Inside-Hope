<apex:page standardController="BMCServiceDesk__Change_Request__c" extensions="ChangeOwnerWithNoteChangeController" sidebar="false" showHeader="false">
<apex:includeScript value="{!URLFOR($Resource.jquery, 'jquery/jquery-1.10.2.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.jquery, 'jquery/ui/jquery-ui.min.js')}"/>
<apex:stylesheet value="{!URLFOR($Resource.jquery, 'jquery/themes/smoothness/jquery-ui.css')}"/>
<script type="text/javascript">
//jQuery used for runtime validation
    var $j = jQuery.noConflict();
    $j(document).ready(function(){

    //Hide the necessary fields and labels on load
        $j('[id$=saveButton]').hide();
        var changed = false;
        var q = $j('[id$=Queues]').val();
        if (q != null && q != "" ){
            $j('[id$=queueSelect]').hide();
        }

        var tskState = {!state};
        
        if (tskState == false){
            $j('[id$=Queues]').attr("disabled", "disabled");
            $j('[id$=Staff]').attr("disabled", "disabled");
            $j('[id$=inote]').attr("disabled", "disabled");
        }

        $j('[id$=Queues]').change(function(){
            var q = $j('[id$=Queues]').val();
            var notesValue = $j('[id$=note]').val();
            if (q != null && q != ""   ){
                $j('[id$=queueSelect]').hide();
                $j('[id$=saveButton]').show();
            } else {
                $j('[id$=queueSelect]').show();
                $j('[id$=saveButton]').hide();
            }
        });
        
        $j('[id$=Staff]').change(function(){
            var q = $j('[id$=Staff]').val();
            var notesValue = $j('[id$=note]').val();
            if (q != null && q != ""   ){
                $j('[id$=saveButton]').show();  
            } else {
                $j('[id$=saveButton]').hide();
            }
        });
        
        $j('[id$=note]').bind('input propertychange', function(e){
            var notesValue = $j('[id$=note]').val();
            var q = $j('[id$=Queues]').val();
            if (q != null && q!= "" && notesValue.length > 0){
                $j('[id$=saveButton]').show();              
            }
        });

    });
    
</script>

    <apex:form id="changeOwnerForm" target="_parent">
        <apex:actionFunction name="CallSave" />
            <apex:pageMessages />
                
        <apex:pageBlock mode="maindetail" id="block">
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Save" action="{!save}" id="saveButton" />
            </apex:pageBlockButtons>
        <apex:pageBlockSection columns="1" showHeader="false" id="pbs" >
            
                <apex:pageBlockSectionItem id="Messaging" >
                    <apex:outputPanel style="color:red;font-weight: bold;text-align: center;" layout="block" id="queueSelect">You must select a Queue.</apex:outputPanel>
                </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem id="pbsi">
                <apex:outputLabel value="Queue Name" for="Queues" />
                <apex:outputPanel id="op">
                    <apex:selectList size="1" value="{!selectedQueue}" id="Queues" required="True">
                        <apex:selectOptions value="{!QueueList}" />
                        <apex:actionSupport event="onchange" rerender="Staff" />
                    </apex:selectList>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
            <apex:pageBlockSectionItem id="pbsi1">
                    <apex:outputLabel value="Staff Name" for="Staff" />
                    <apex:selectList size="1" value="{!selectedStaff}" id="Staff">
                        <apex:selectOptions value="{!StaffList}" />
                    </apex:selectList>        
            </apex:pageBlockSectionItem>
            <apex:pageBlockSectionItem id="pbsi2"> 
                    <apex:outputLabel value="Please enter a reason for Re-assigning the Change Request:" style="color:red;" for="inote" id="lblNote" />
                    <apex:inputTextArea id="inote" cols="120" rows="4" value="{!change.Notes__c}"/>
            </apex:pageBlockSectionItem>
            
        </apex:pageBlockSection>
        </apex:pageBlock>
    </apex:form>
</apex:page>