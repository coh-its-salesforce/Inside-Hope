<!--Removed header and sidebar, set Object for controller-->
<apex:page standardController="Values_in_Action__c" extensions="VIA_NominationController1" showHeader="false" sidebar="false" id="page"> 
    
    <!--Add characteristics to the JavaScript for each extension Note: !important cascades the rules throughout the page-->
    <apex:includeScript value="{!$Resource.JQuery1}"/>
    <style>
        <!--Creating variables for font characteristics for (styleClass=labelClass), (span class=mandatory),td-->            
        .LabelClass{font-weight: bold;}
        .Mandatory{color: red;}
        td{border:none !important;}
        
        <!--Unable to identify its use-->         
        .hideDropdown select{
        visibility: hidden !important;
        display: block !important;}}
        
        <!--Unable to identify its use-->   
        .pbSubheader{font-size:22px;}
        
        <!--Modifies size of Blue Title-->
        h3{font-size:22px !important;} 
        
        .requiredBlock{color: red;}
        
    </style>
    <script>
    $(document).ready(function(){
        $("div[id$='TDPanel']").css({"background":"white","border":"none"});
        $("select[name*='mlktp']").remove();
    });
    $(document).click(function(){
        $("div[id$='TDPanel']").css({"background":"white","border":"none"});
    });
    function backgrndclr(){
        $("div[id$='TDPanel']").css({"background":"white","border":"none"});
        $("select[name*='mlktp']").remove();
    }
    function updateValues() 
    { modifyTD(); 
    }
    
    function gcExceededEmp(){
        var tempBoolean = $("input[id*='isAmtExceeds']").val();
        //alert(tempBoolean);
        if(tempBoolean == 'true'){
            var r = confirm("Please note that the individual you have selected will exceed the $75 limit and they will be taxed accordingly at the end of the year. Please notify the employee before finalizing the order. \n Please select OK to proceed or CANCEL to make changes to your order.");
            //alert(r);
            if (r == true) {
                txt = $("input[id*='saveRec']").val(true);
                proceedToSave();
            } else {
                //txt = $("input[id*='saveRec']").val(false);
            }
        }
        
    }
    function navigatetoURL(){
        window.open('/00O0V000005c5UE');
    }
    
    var newWin=null;
    
    //Start Sanjay Jan 13th 2022: DELEGATED USER LOOKUP CHANGE
    function openLookupPopup(name,inputid)
    {
        
        var searchTerm = document.getElementById(name).value;
        var url="/apex/Lookup?namefield=" + name+"&searchTerm="+searchTerm+"&inputid="+inputid;
        newWin=window.open(url, 'Popup','height=500,width=600,left=100,top=100,resizable=no,scrollbars=yes,toolbar=no,status=no');
        if (window.focus)
        {
            newWin.focus();
        }
        
        return false;
    }
    
    function closeLookupPopup()
    {
        if (null!=newWin)
        {
            newWin.close();
        }
    }
    //END Sanjay Jan 13th 2022: DELEGATED USER LOOKUP CHANGE
    </script>
    <!--Script that pulls data based on the selection of the giftcard dropdown box-->
    <script type="text/javascript">
    
    //Start Sanjay June 6th 2020
    function hideandshow(){
        var e = document.getElementsByClassName("selectbox")[0];
        var strUser = e.options[e.selectedIndex].value;
        console.log('======='+strUser);
        
        if(strUser=='ecard-$25'|| strUser=='ecard-$10'){
            document.getElementById('{!$Component.page.gfForm.TDPanel.section1.pickuppanel}').style.display="none";
        }
        else{
            document.getElementById('{!$Component.page.gfForm.TDPanel.section1.pickuppanel}').style.display="block";
        }
    }
    //End Sanjay June 6th 2020 
    
    function countChars(obj){
       document.getElementById("characterCount").innerHTML = obj.value.length;
        
    }

    </script>      
    
    <apex:form id="gfForm">
        <apex:actionFunction action="{!modifyTD}" name="modifyTD" reRender="NominatorInfo"  oncomplete="backgrndclr()"/>
        <apex:actionFunction action="{!Save}" name="proceedToSave" reRender="NominatorInfo"/>
        <apex:pagemessages id="pagemessage">  </apex:pagemessages>
        <apex:pagemessage Rendered="{!pageMessage}" severity="Error"></apex:pagemessage>
        <apex:pageBlock title="Non-Cash Award Request Form" id="TDPanel" rendered="{!IF(options1.size > 0,true,false)}">
            <apex:inputhidden value="{!empAmtExceeds}" id="isAmtExceeds"/>
            <apex:inputhidden value="{!empAmtExceed}" id="AmtExceedEmp"/>
            <apex:inputhidden value="{!saveRec}" id="saveRec"/>
            <input type="hidden" name="currentvfpage" value="{!$CurrentPage.Name}"/>
            
            <apex:outputText value="* Required" styleClass="Mandatory"></apex:outputText>
            <div style='text-align: center;'>
                <apex:image value="{!$Resource.GiftCard}"/>      
                <br/>
                <apex:outputText style="font-style:italic" value="Welcome to the Non-Cash Reward and Recognition Program! Leaders who have direct reports can now request gift cards such as AMC Theaters, Amazon, Starbucks, Trader Joe’s and Target, to recognize and celebrate employee contributions. You have been allocated a budget of $50 for each direct report per calendar year. Please note that anything above this amount will be charged to your department’s budget. In addition, employees will be taxed if they receive a reward that exceeds the $75 annual limit. As a reminder, this program is not to be used in connection with birthdays, holidays or personal occasions. If you have any questions, please contact recognition@coh.org.">
                </apex:outputText>
            </div>
            
            <span style="color:red;font-size: 16px">In response to the COVID-19 situation, only e-gift cards can be ordered at this time. No physical gift card are available at this time</span><br/>
            <span style="background-color: red;color:black;font-size: 16px">Effective 11/11/2020, E-gift cards will now be emailed directly to the recipients at their City of Hope email address along with your explanation.</span><br/>
            <span style="color:red;font-size: 16px">Thank you for your patience. Any questions, please contact recognition@coh.org.</span>   
                                   
            <apex:pageblockSection columns="1" title="Employee Information" id="section1">
                <!--START----CHANGES BY SANJAY 02/13/2022 DELEGATED USER LOOKUP CHANGE -->
                <apex:outputLabel value="Delegated User"/>
                <apex:outputPanel >
                    <apex:inputHidden value="{!delegatedUserId}" id="inputid" />
                    <apex:inputText size="20" value="{!delegatedUserName}" id="inputname"/>
                    <a href="#" onclick="openLookupPopup('{!$Component.inputname}','{!$Component.inputid}');">
                        <apex:image value="{!$Resource.lookupicon}" height="15px"/>
                    </a>
                </apex:outputPanel>
                <!--END----CHANGES BY SANJAY 02/13/2022 DELEGATED USER LOOKUP CHANGE -->
                <h2>Remaining balance amount for allocation : ${!balAmt}</h2><br/>
                <apex:outputPanel id="balErr">
                    <apex:outputLabel value="" style="color:red;" Rendered="{!balAmtExceeds}" >Error : For additional funds, please email recognition@coh.org and your manager the reason for the increased amount. Please note that additional funds will be charged to your cost center.</apex:outputLabel> 
                </apex:outputPanel>
                <!--<apex:outputPanel id="empAmtErr">
<apex:outputLabel value="" style="color:red;" Rendered="{!empAmtExceeds}" >Error : Please note that the person you have selected will reach the $75 limit for the calendar year. Please contact Brandace Ukwuije at bukwuije@coh.org for assistance. : <br/>{!empAmtExceed}</apex:outputLabel> 
</apex:outputPanel>-->
                
                <!--Direct Report section-->
                <!--<apex:outputLabel value="Account/Cost center:" styleClass="LabelClass"></apex:outputLabel><apex:inputText value="{!additionalamount}" id="addamount"/><br/>-->
                <apex:outputLabel value="Direct Report"  title="Employee" styleClass="LabelClass"> <span class='Mandatory'>: *</span></apex:outputLabel> 
                To select multiple employees, please hold down “Ctrl” then select the names.
                <apex:outputPanel id="empErr">
                    <apex:outputLabel value="" style="color:red;" Rendered="{!usernull}" >Error : Please provide First and Last Name</apex:outputLabel> 
                </apex:outputPanel>
                
                
                <!--Created dropdown of Direct Reports, set list box to the number of direct reports maximum size set to 6
also added sort on line 130 under VIA_NominationController1.apxc to sort names alphabetically [Larry Kiang]-->
                <apex:selectList value="{!GCSelectedUser}" multiselect="true" size="{!if(options1.size>=6,6,options1.size)}" onchange="modifyTD();">
                    <apex:selectOptions value="{!options1}"></apex:selectOptions>
                </apex:selectList>
                
                
                <apex:outputPanel id="cardPanel">
                    <apex:outputLabel value=" Select the type of Gift Card" styleClass="LabelClass"><span class='Mandatory'>: *</span></apex:outputLabel><br/>
                    <apex:outputLabel value="" rendered="{!giftcardtype}" style="color:red;" id="gcType">Please select type of gift card<br/></apex:outputLabel>
                    <apex:inputField value="{!Values_in_Action__c.Gift_Card_Type__c}" label=""  >
                        <apex:actionSupport action="{!amoutValues}" reRender="cardPanel" event="onchange"/>
                        <br/><br/>
                        
                        <!--Created image that appear when the gift card type is selected. Images are located in the static resources and using render to determine when the image shows up. [Larry Kiang]-->
                        <apex:image id="starBucks" value="{!if(Values_in_Action__c.Gift_Card_Type__c=='Starbucks',"/resource/1550386276000/StarbucksGiftCardImage?",null)}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c='Starbucks'}"/>
                        <apex:image id="amc" value="{!if(Values_in_Action__c.Gift_Card_Type__c=='AMC Tickets',"/resource/1549579035000/AMCTicketsImage",null)}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='AMC Tickets'}"/>
                        <apex:image id="amazon" value="{!if(Values_in_Action__c.Gift_Card_Type__c=='Amazon',"/resource/1549580184000/AmazonGiftCardImage",null)}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='Amazon'}"/>
                        <apex:image id="panera" value="{!if(Values_in_Action__c.Gift_Card_Type__c=='Panera',"/resource/1591194227000/PaneraGiftCardImage",null)}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='Panera'}"/>
                        <apex:image id="target" value="{!if(Values_in_Action__c.Gift_Card_Type__c=='Target gift',"/resource/1550387877000/TargetGiftCardImage?",null)}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='Target gift'}"/>    
                        <apex:image id="traderJoes" value="{!if(Values_in_Action__c.Gift_Card_Type__c=='Trader Joe’s',"/resource/1549581824000/TraderJoesGiftCardImage",null)}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='Trader Joe’s'}"/>   
                        <!--- Changes by Sanjay Singh - Date 11/06/2020---Start---->
                        <apex:image id="TJMAX" value="{!URLFOR($Resource.GIFT_CARD_IMAGES,'TJMAX.png')}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='TJ MAX'}"/> 
                        <apex:image id="Nike" value="{!URLFOR($Resource.GIFT_CARD_IMAGES,'NIKELOGO.png')}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='Nike'}"/>
                        <apex:image id="UberEats" value="{!URLFOR($Resource.GIFT_CARD_IMAGES,'UberEats.png')}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='Uber Eats'}"/>
                        <apex:image id="Macys" value="{!URLFOR($Resource.GIFT_CARD_IMAGES,'Macys.jpg')}" width="150" height="93" alt="" rendered="{!Values_in_Action__c.Gift_Card_Type__c=='Macys'}"/>
                        <!--- Changes made by Sanjay Singh - Date 11/06/2020---End----> 
                    
                    </apex:inputField><br/><br/>
                    
                    <apex:outputLabel value="Select the Amount" styleClass="LabelClass"><span class='Mandatory'>: *</span></apex:outputLabel><br/>
                    <apex:outputLabel value="" rendered="{!giftcardamount}" style="color:red;" id="gcAmt">Please select the amount<br/></apex:outputLabel>
                    <!-- Changes made by Sanjay Singh ----Date-06/05/2020---START-->
                    <apex:selectList value="{!Values_in_Action__c.Gift_Card_Amount__c}" id="amountField" multiselect="false" size="1" styleclass="selectbox" >
                    <apex:actionSupport event="onchange" reRender="pickuppanel" />
                    <apex:selectOptions value="{!getGFValues}"></apex:selectOptions>
                     </apex:selectList><br/><br/>
                    <!--Changes made by Sanjay Singh ----Date-06/05/2020---END-->
                    <!-- <apex:outputLabel value="{!$ObjectType.Values_in_Action__c.fields.Title__c.Label}" styleClass="LabelClass"><span class='Mandatory'>: *</span></apex:outputLabel>   <apex:outputText value="{!Values_in_Action__c.Title__c}" Label="" id="nTitle"/>
                    <apex:outputLabel value="{!$ObjectType.Values_in_Action__c.fields.Department__c.Label}" styleClass="LabelClass"><span class='Mandatory'>: *</span> </apex:outputLabel> <apex:outputText value="{!Values_in_Action__c.Department__c}" label="" id="nDept"/>-->
                    
                    <apex:outputLabel value="Please provide an explanation as to why this individual is being awarded. This message will be sent directly to the recipient’s City of Hope email address along with the gift card. " styleClass="LabelClass" ><span class='Mandatory'>: *</span><br/> </apex:outputLabel> 
                    <apex:outputLabel value="" style="color:red;" Rendered="{!nomineeDesc}" id="desc">Error : Please provide the Description<br/> </apex:outputLabel> 
                    <apex:outputLabel value="" style="color:red;" Rendered="{!errormsg}">Error : Description should be less than 250 characters<br/></apex:outputLabel>  
                    <apex:inputTextarea value="{!Values_in_Action__c.Describe_how_nominee_goes__c}" html-maxlength="250" onkeyup="countChars(this);" label="" style="margin: 0px; width: 519px; height: 97px;">
                    
                    </apex:inputTextarea>
                    <br/>
                   <i> <apex:outputPanel id="lengthCounter"> Total Characters : <span id="characterCount">{!len(Values_in_Action__c.Describe_how_nominee_goes__c)}</span> / 250 
                    
                    </apex:outputPanel></i> 
                    <br/><br/> 
                    
                 <apex:outputPanel id="pickuppanel" style="display: block;" >
                 <!--- CHanges Mande by Sanjay - Date 11/06/2020---start---->
                      <apex:outputPanel style="display: block;" rendered="{!NOT(contains(Values_in_Action__c.Gift_Card_Amount__c,'ecard'))}"><!-- AND(Values_in_Action__c.Gift_Card_Amount__c != 'ecard-$10', Values_in_Action__c.Gift_Card_Amount__c != 'ecard-$25')-->
                    <!--- CHanges Mande by Sanjay - Date 11/06/2020---END---->
                     <apex:outputLabel value="Pick up Location" styleClass="LabelClass"><span class='Mandatory'>: *</span><br/> </apex:outputLabel><br/>
                     <apex:inputField value="{!Values_in_Action__c.Pick_up_location__c}" label=""/>
                    <!--{!IF(Values_in_Action__c.Gift_Card_Amount__c=='$10' || Values_in_Action__c.Gift_Card_Amount__c=='Quantity - 2 ($10 each)' || Values_in_Action__c.Gift_Card_Amount__c=='$25',true,false)}"/>-->
                    </apex:outputPanel>
                  </apex:outputPanel>
                    <!-- Changes made by Sanjay Singh ----Date-06/05/2020---END-->
                    <apex:outputLabel value="" style="color:red;" Rendered="{!pickupLocation}" id="pickup">Error : Please select the pickup location<br/> </apex:outputLabel>
                    
                    
                    
                </apex:outputPanel>
                
                
            </apex:pageblockSection>
            
            
            <apex:pageblockSection columns="1" title="Direct Supervisor Information" id="NominatorInfo">
                <apex:outputLabel value="{!$ObjectType.Values_in_Action__c.fields.First_and_Last_Name__c.Label}" styleClass="LabelClass"> <span class='Mandatory'>: *</span></apex:outputLabel><apex:outputText value="{!Values_in_Action__c.First_and_Last_Name__c}" Label=""/> 
                <apex:outputLabel value="{!$ObjectType.Values_in_Action__c.fields.Employee_ID__c.Label}" styleClass="LabelClass"><span class='Mandatory'>: *</span> </apex:outputLabel><apex:outputText value="{!Values_in_Action__c.Employee_ID__c}" Label=""/>
                <apex:outputLabel value="{!$ObjectType.Values_in_Action__c.fields.COH_Email_Address__c.Label}" styleClass="LabelClass"><span class='Mandatory'>: *</span> </apex:outputLabel><apex:outputText value="{!Values_in_Action__c.COH_Email_Address__c}" Label=""/>
                <apex:outputLabel value="Title" styleClass="LabelClass"><span class='Mandatory'>: *</span> </apex:outputLabel> <apex:outputText value="{!Values_in_Action__c.Nominator_Title__c}" Label=""/>
                <apex:outputLabel value="Department" styleClass="LabelClass"> <span class='Mandatory'>: *</span></apex:outputLabel> <apex:outputText value="{!Values_in_Action__c.Nominator_Department__c}" Label=""/>
                <p><strong>I acknowledge that non-cash awards should be tied to performance and not be connected to birthdays, weddings, holidays, farewells, and other occasions. If the cumulative or one-time award exceeds the allowable limits of $75 per person in a calendar year, it creates a taxable event for the employee.</strong></p>
                <apex:outputLabel value="Please acknowledge the terms and conditions" style="color:red;" rendered="{!ackError }"></apex:outputLabel>
                <apex:outputPanel id="chkBox">
                    <apex:inputCheckbox value="{!acknowledge}"/>  I acknowledge that I have read and agree to the above. <span class='Mandatory'> *</span>
                    <br/>
                    <br/>
                    <br/>
                    
                    
                    <div align="center" draggable="false">         
                        <apex:actionStatus id="saveStatus">
                            <apex:facet name="stop">
                                <apex:commandButton value="Submit" action="{!Save}" status="saveStatus" reRender="empErr,pagemessage,cardPanel,NominatorInfo,balErr,empAmtErr,isAmtExceeds,AmtExceedEmp,saveParentBlock" oncomplete="gcExceededEmp();"/> 
                            </apex:facet>
                            <apex:facet name="start">
                                <apex:commandButton value="Saving..." disabled="true" status="saveStatus"/>
                            </apex:facet>
                        </apex:actionStatus>    
                        &nbsp;&nbsp;&nbsp;
                        
                        <apex:commandButton value="Cancel" action="{!cancel}"/>
                        &nbsp;&nbsp;
                        <!--START----CHANGES BY SANJAY 02/13/2022 DELEGATED USER LOOKUP CHANGE -->
                        <apex:commandButton value="Save Delegated User" action="{!saveDelegatedUser}"/>
                        &nbsp;&nbsp;
                        <!--END----CHANGES BY SANJAY 02/13/2022 DELEGATED USER LOOKUP CHANGE -->
                        <input type="button" value="Amount Spent" class="btn" onclick="navigatetoURL();"/>
                    </div>
                </apex:outputPanel>
            </apex:pageblockSection>      
        </apex:pageBlock>   
        <!--used to verify direct reports under user-->
        <apex:pageBlock rendered="{!IF(options1.size > 0,false,true)}">
            <br/><br/><br/><br/>
            <center> <h2 style="color:red;font-size: 25px;">This page is not accessible</h2></center>
        </apex:pageBlock>
    </apex:form>
    
    
</apex:page>