<apex:page sidebar="false" showHeader="false" standardStylesheets="false" 
           applyHtmlTag="false" applyBodyTag="false" docType="html-5.0" controller="SearchController" id="page" >
    
     
    <html lang="en">
        <head>
            <c:Head title="Search Results"></c:Head>
           
            <link href="https://cdn.datatables.net/1.10.8/css/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css"/>
            
             <style type="text/css">
            /*
             
            /*
             * Off Canvas
             * --------------------------------------------------------------
             */
            @media screen and (max-width: 768px) {
              .row-offcanvas {
                position: relative;
                -webkit-transition: all 0.25s ease-out;
                -moz-transition: all 0.25s ease-out;
                transition: all 0.25s ease-out;
              }
            
              .row-offcanvas-left
              .sidebar-offcanvas {
                left: -33%;
              }
            
              .row-offcanvas-left.active {
                left: 33%;
              }
            
              .sidebar-offcanvas {
                position: absolute;
                top: 0;
                width: 33%;
                margin-left: 10px;
              }
            }
            
            
            /* Sidebar navigation */
            .nav-sidebar {
              background-color: #f5f5f5;
              margin-right: -15px;
              margin-bottom: 20px;
              margin-left: -15px;
            }
            .nav-sidebar > li > a {
              padding-right: 20px;
              padding-left: 20px;
            }
            .nav-sidebar > .active > a {
              color: #fff;
              background-color: #428bca;
            }
            
            /*
             * Main content
             */
            
            
            @media (min-width: 768px) {
              .main {
                padding-right: 40px;
                padding-left: 40px;
              }
            }
            .main .page-header {
              margin-top: 0;
            }
            #Searching_Modal {z-index:9999}
            .ad {
              position: absolute;
              bottom: 70px;
              right: 48px;
              z-index: 992;
              background-color:#f3f3f3;
              position: fixed;
              width: 155px;
              padding:1px;
            }
            
            .ad-btn-hide {
              position: absolute;
              top: -10px;
              left: -12px;
              background: #fefefe;
              background: rgba(240,240,240,0.9);
              border: 0;
              border-radius: 26px;
              cursor: pointer;
              padding: 2px;
              height: 25px;
              width: 25px;
              font-size: 14px;
              vertical-align:top;
              outline: 0;
            }
            
            .carbon-img {
              float:left;
              padding: 10px;
            }
            
            .carbon-text {
              color: #888;
              display: inline-block;
              font-family: Verdana;
              font-size: 11px;
              font-weight: 400;
              height: 60px;
              margin-left: 9px;
              width: 142px;
              padding-top: 10px;
            }
            
            .carbon-text:hover {
              color: #666;
            }
            
            .carbon-poweredby {
              color: #6A6A6A;
              float: left;
              font-family: Verdana;
              font-size: 11px;
              font-weight: 400;
              margin-left: 10px;
              margin-top: 13px;
              text-align: center;
            }
            .breadcrumb{
                 margin-top:60px;
                 }
          .table-nowrap {
                table-layout:fixed;
            }
            
            .table-nowrap td {
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
            
            } 
                 /* SFIP-60 - Abhishek */
                 .wordwrap { 
                 white-space: pre-wrap;  
                 white-space: -moz-pre-wrap;
                 white-space: -pre-wrap; 
                 white-space: -o-pre-wrap;  
                 word-wrap: break-word;
                 max-height: 200px;
                 overflow: auto;
                 }
                 /* SFIP-60 - Abhishek */
        </style>
        </head>
        <body>
            <div class="Wrapper">
            <apex:form id="form">
                
            <!-- Abhisheks Code for Common Theme Starts--->    
                <c:COH_SIP_Header ></c:COH_SIP_Header>
                <c:COH_SIP_Favorite_Float ></c:COH_SIP_Favorite_Float>     
            <!-- Abhisheks Code for Common Theme Ends--->        
                
                <apex:actionFunction action="{!createFilterStr}" name="applyFilter" reRender="inpf,contStr,fileStr,scopeStr,scPanel" status="loading"/>
                <apex:inputHidden value="{!filterString}" id="inpf" />
                <apex:inputHidden value="{!contentTypeStr}" id="contStr"/>
                <apex:inputHidden value="{!fileTypeStr}" id="fileStr"/>
                 <apex:inputhidden value="{!scopeTypeStr}" id="scopeStr" />
                <apex:actionStatus id="loading" onstart="$('#Searching_Modal').modal('show');" onstop="$('#Searching_Modal').modal('hide');"/>
                
                <div class="SearchBox">
                    <div class="SerMidWrp">
                        <div class="SerchBoxSecondary">
                            <apex:inputText value="{!keyword}" id="searchKeyword" html-placeholder="People, documents, departments and news" styleClass="SerInpT" />
                         <!-- Sanjay 01/20   <apex:commandButton value="GO" id="searchBtn" styleClass="GoButS" /> -->
                            <button class="btn btn-primary GoButS" type="button" id="searchBtn">GO</button>    
                        </div>
                    </div>
                </div>
                
                <!-- page Body Content-->
                <!-- Container -->
                
            <div class="container-fluid" style="padding: 150px 0 0 0;height: 100%;">
                <div class="row row-offcanvas row-offcanvas-left">
        
                    <div class="col-sm-3 col-md-2 sidebar-offcanvas" id="sidebar" role="navigation">
                        <div class="list-group">
                         <div class="list-group-item active">
                          <h>Filters</h>
                         </div>
                          <div class="list-group-item">
                            <center>
                             <apex:commandButton styleClass="btn-success" value="Apply Filter" action="{!createFilterStr}" reRender="inpf,contStr,fileStr,scopeStr" status="loading" oncomplete="startSearching();"/> 
                            <!-- <button type="button" class="btn btn-success btn-small" onclick="applyFilter();">Apply Filter</button> --></center>
                         </div>
                         <div style="text-align:right">
                             <a href="#" id="clrFltr" >Clear Filter</a>
                            </div>
                         <div class="list-group-item">
                         
                           <!-- Start Comments by Sanjay Singh on Nov 1st 2015 -->
                              <div>
                               <label class="checkbox-inline"><input type="checkbox" value="" id="personFullname"/>Person's Full Name </label>
                              </div>
                             <div>
                                 <label class="checkbox-inline"><input type="checkbox" value="" id="departmentCheck"/>Person's Department</label>
                                 <!--   <label class="checkbox-inline"><input type="checkbox" value="" id="departmentCheck"/> Department</label> -->
                             </div>
                              <div>
                               <label class="checkbox-inline"><input type="checkbox" value="" id="documentLibCheck"/>Document Library</label>
                              </div>
                              <div>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" value="" id="documentTypeCheck" onclick="toggleRtypeCheck(this, 'rtCheck');" />Document Type
                                    </label>
                                    <div style="padding-left:15px;">
                                        <apex:repeat value="{!contentTypeList}" var="ct">
                                            <div>
                                                <span>
                                                    <apex:inputcheckbox styleclass="rtCheck" value="{!ct.isSelect}" onclick="checkParent(this, 'documentTypeCheck');" />
                                                    {!ct.rectypeName}
                                                </span>
                                            </div>
                                        </apex:repeat>
                                    </div>
                                </div>
                              <div>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" value="" id="softAppCheck" onclick="toggleRtypeCheck(this, 'ftCheck');" />Software Application
                                    </label>
                                    <div style="padding-left:15px;">
                                        <apex:repeat value="{!fileTypeList}" var="ct">
                                            <div>
                                                <span>
                                                    <apex:inputcheckbox styleclass="ftCheck" value="{!ct.isSelect}" onclick="checkParent(this, 'softAppCheck');" />
                                                    {!ct.fileType}
                                                </span>
                                            </div>
                                        </apex:repeat>
                                    </div>
                                </div>
                              <div>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" value="" id="docPolicyCheck" onclick="toggleRtypeCheck(this, 'scopeCheck')" />Document Policy Scope
                                    </label>
                                    <div style="padding-left:15px;">
                                        <apex:repeat value="{!scopeTypeList}" var="ct">
                                            <div>
                                                <span>
                                                    <apex:inputcheckbox styleclass="scopeCheck" value="{!ct.isSelect}" onclick="checkParent(this, 'docPolicyCheck');" />
                                                    {!ct.scopePicklistEntry}
                                                </span>
                                            </div>
                                        </apex:repeat>
                                    </div>
                                </div>

                              
                              
                              
                              <div>
                               <label class="checkbox-inline"><input type="checkbox" value="" id="depPageCheck"/>Department Page</label>
                              </div>
                              <div>
                               <label class="checkbox-inline"><input type="checkbox" value="" id="newsCheck"/>News &amp; Announcements</label>
                              </div>
                              
                                
                              
                          </div>
                          
                          <!-- End Commented by Sanjay Singh on Nov 1st 2015 -->
   
                         <apex:repeat value="{!filterList}" var="f">
                            
                            <div class="list-group-item">
                              <apex:outputText value="{!f.Field.search_Object__r.Name}/{!f.Field.Name}" /> <br/>
                              <apex:inputText value="{!f.Obj[f.Field.Field_API_Name__c]}" styleClass="form-control" />
                            </div>
                         </apex:repeat>
                      </div>
                      

                      
                    </div><!--/span-->
                    
                    <div class="col-sm-9 col-md-10 main">
                       <!--toggle sidebar button-->
                       <p class="visible-xs">
                            <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas"><i class="glyphicon glyphicon-chevron-left"></i></button>
                       </p>
                       <!--Changes by Abhishek to align search results label and message-->
                       <nav class="navbar navbar-default row">
                          <div class="container-fluid">
                            <div class="navbar-header">
                              
                                <a href="#" class="navbar-brand">
                                    Search Results
                                </a>
                              
                            </div>
                          </div>
                        </nav>
                        
                        
                        <div id="msg" style="display:none;"></div>
                        <div id="searchResult" class="row">
                            
                        </div>
                    </div>
                </div>
             </DIV>   
             <!-- Script Added-->
             <div id="Searching_Modal" class="modal fade" tabindex="-1" role="dialog" data-keyboard="false"
                 data-backdrop="static">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        
                        <div class="modal-body" >
                            <center>
                            <h4>Please Wait..</h4>
                            <h1><i class="fa fa-spinner fa-spin"></i></h1>
                            </center>
                        </div>
                    </div>
                </div>
            </div>
         <c:Scripts ></c:Scripts>
         <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.8/js/jquery.dataTables.min.js"></script>       
         <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.8/js/dataTables.bootstrap.min.js"></script>       
         
         <script type='text/javascript'>
                // Minified version of isMobile included in the HTML
        		!function(a){var b=/iPhone/i,c=/iPod/i,d=/iPad/i,e=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,f=/Android/i,g=/IEMobile/i,h=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,i=/BlackBerry/i,j=/BB10/i,k=/Opera Mini/i,l=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,m=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),n=function(a,b){return a.test(b)},o=function(a){var o=a||navigator.userAgent,p=o.split("[FBAN");return"undefined"!=typeof p[1]&&(o=p[0]),this.apple={phone:n(b,o),ipod:n(c,o),tablet:!n(b,o)&&n(d,o),device:n(b,o)||n(c,o)||n(d,o)},this.android={phone:n(e,o),tablet:!n(e,o)&&n(f,o),device:n(e,o)||n(f,o)},this.windows={phone:n(g,o),tablet:n(h,o),device:n(g,o)||n(h,o)},this.other={blackberry:n(i,o),blackberry10:n(j,o),opera:n(k,o),firefox:n(l,o),device:n(i,o)||n(j,o)||n(k,o)||n(l,o)},this.seven_inch=n(m,o),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0},p=function(){var a=new o;return a.Class=o,a};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=o:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=p():"function"==typeof define&&define.amd?define("isMobile",[],a.isMobile=p()):a.isMobile=p()}(this);

                var $ = jQuery.noConflict();
                $(document).ready(function() {
                      $('[data-toggle=offcanvas]').click(function() {
                        $('.row-offcanvas').toggleClass('active');
                      });
                      
                     //Onload KeyWordSearch
                     //changes made by Sanjay 1/19/2016 for Apostrosphe fix
                    // changes singlequote to double quote.
                    var searchKeyWord =  "{!JSENCODE(keyword)}";
                    //var searchKeyWord =  '{!keyword}';
                                    
                    if(searchKeyWord != ''){
                        $('#Searching_Modal').modal('show');
                        findResults(searchKeyWord);
                    }
                    
                    
                    
                    $('#searchBtn').click(function(){
                       startSearching(); 
                        
                    });
                    /*  Method-- for Start search on hit Enter */
                     $(document).keypress(function(e) {
                        if(e.which == 13) {
                            startSearching();
                            e.preventDefault();
                        }
                    });
                    /*  Method End  */
                    
                });
                
                function startSearching(){
                    // Open Loading pop up
                    $('#Searching_Modal').modal('show');
                    // Fetch enterd keyword
                    var key = document.getElementById('{!$component.searchKeyword}').value;
                    // Find keyword
                    findResults(key);                    
                }
                    
                function findResults(keyWord){
                    //clear search result panel for new search
                    $("#searchResult").html('');
                    $("#msg").html('');
                    $("#msg").show();
                    // variable to store value entered in filter 
                    var filterFieldVal = document.getElementById('page:form:inpf').value;
                    // variable to store selected content version record Type
                    var conTypeFilterVal = document.getElementById('page:form:contStr').value;
                    // variable to store selcted doc type value
                    var fileTypeFilterVal = document.getElementById('page:form:fileStr').value;
                    // variable to store selected scopes
                    var scopeTypeFilterVal = document.getElementById('page:form:scopeStr').value;
                   
                    var filterStr = '';
                    var conTstr  = '';
                    var fileStr = '';
                    var scopeStr = '';
                    if(filterFieldVal != 'undefined' || filterFieldVal != ''){
                        filterStr = filterFieldVal;
                    }
                    if(conTypeFilterVal != 'undefined' || conTypeFilterVal != ''){
                        conTstr = conTypeFilterVal;
                    }
                    if(fileTypeFilterVal != 'undefined' || fileTypeFilterVal != ''){
                        fileStr = fileTypeFilterVal;
                    }
                    if(scopeTypeFilterVal != 'undefined' || scopeTypeFilterVal != ''){
                        scopeStr = scopeTypeFilterVal;
                    }
                    // Variables to check which filter checkbox id checkd or not
                    var check1 = $('#personFullname').is(':checked') ;
                    var check2 = $('#departmentCheck').is(':checked') ;
                    var check3 = $('#documentLibCheck').is(':checked') ;
                    var check4 = $('#documentTypeCheck').is(':checked') ;
                    var check5 = $('#softAppCheck').is(':checked') ;
                    var check6 = $('#docPolicyCheck').is(':checked') ;
                    var check7 = $('#depPageCheck').is(':checked') ;
                    var check8 = $('#newsCheck').is(':checked') ;
                    // Call remote method of class.
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.SearchController.searchKeyWord}',
                       keyWord, filterStr,conTstr, fileStr,scopeStr, check1, check2,check3, check4,check5, check6,check7, check8 , 
                        function(results, event){
                            if (event.status) {
                                // Do something
                                if(results.length > 0){
                                
                                var htmlstr = '';
                                var recFoundFlag = false;
                                $.each(results, function(){
                                    // Dynamically generate panels and tables. 
                                    if(this.sObjList.length > 0){
                                        htmlstr= htmlstr+'<div class="panel panel-default">'+
                                                    '<div class="panel-heading searchSectioHeader">'+this.objLabel+'</div>'+
                                                  '<div class="panel-body">';
                                       <!-- Sanjay Jan 05 htmlstr += '<table class="table table-bordered searchRecordTable table-nowrap" id="'+this.objectName+'"> <thead><tr><th style="width:6%" data-bSortable="false"></th>'; -->
                                        
                                        htmlstr += '<table class="table table-bordered searchRecordTable table-nowrap" id="'+this.objectName+'"> <thead><tr><th data-bSortable="false"></th>';
                                        
                                        if(this.fieldList.length > 0) {
                                            //Abhisheks changes to show only 3 columns on mobile
                                             for(var fi=0; fi<this.fieldList.length;fi++){
                                                 if(!(isMobile.any && fi > 2)){
                                                     htmlstr +='<th>'+this.fieldList[fi]['Name'] +'</th>';
                                                 }
                                             } 
                                         }else{
                                            htmlstr +='<th>ID</th>';
                                        }   
                                        htmlstr += '</tr></thead><tbody>' ;
                                        var objName = this.objectName;
                                        var userPageURL = '{!$Page.userprofile}';   
                                        for(var i=0; i<this.sObjList.length;i++){
                                             var recID = this.sObjList[i]['Id'];
                                             recFoundFlag = true;
                                             var recIdKeyPrefix = recID.substring(0,3);
                                             var redPageUrl = '';
                                             // redirect to userDetail Vf page if userId found. 
                                             if(recIdKeyPrefix == '005'){
                                                 redPageUrl = userPageURL +'?uId='+recID ;
                                             }
                                             
                                             /* Start Sanjay Singh 01/27 */
                                             
                                             /*else if(recIdKeyPrefix == '{!WhomSuppWhom}'){
                                               
                                                redPageUrl = userPageURL +'?uId='+this.sObjList[i]['Supported_User__c'] ;
                                                 
                                             }*/
                                             
                                             /* End Sanjay Singh 01/27 */
                                             
                                             // redirect to DepartmentPortal vf page if department rec viewed
                                             else if(recIdKeyPrefix == '{!departmentKeyPrefix}'){
                                               redPageUrl = '{!$Page.DepartmentPortal}?id='+recID;
                                             }
                                             // redirect to SIRP_SecondaryDepartment vf page if secondary department rec viewed
                                             else if(recIdKeyPrefix == '{!secDepKeyPrefix}'){
                                               redPageUrl = '{!$page.SIRP_SecondaryDepartment}?isSecondary=True&id='+recID;
                                             }
                                             // redirect to DepartmentPortal vf page if Department Accordion rec viewed
                                             else if(recIdKeyPrefix == '{!depAccordion}'){
                                                redPageUrl = '{!$Page.DepartmentPortal}?id='+this.sObjList[i]['Department_Name__c'];
                                             }
                                             else if(recIdKeyPrefix == '{!newsStr}'){
                                                     /* Changes made by Sanjay Date 12-22-2015
                                                     redirect user to image url in case url is present 
                                                     otherwise redirect to default page
                                                     */
                                                     var imgUrl = this.sObjList[i]['Image_URL__c'];
                                                     if(imgUrl != '' && imgUrl != undefined){
                                                        redPageUrl = imgUrl;
                                                     }else{
                                                        redPageUrl = '{!$Page.NewsAnnouncementDetailPage}?id='+recID;
                                                     }    
                                                 }
                                                 //otherwise redirect to standard detail page.
                                                 else{
                                                     redPageUrl = '/'+recID ;
                                                 }
                                             htmlstr += '<tr><td><a href="'+redPageUrl +'" target="_blank">View</a></td>';
                                             if(this.fieldList.length > 0){
                                                 for(var fi=0; fi< this.fieldList.length;fi++){
                                                     //Abhisheks changes to show only 3 columns on mobile
                                                     if(!(isMobile.any && fi > 2)){
                                                         var fieldVal = this.sObjList[i][this.fieldList[fi]['Field_API_Name__c']];
                                                         var actval = '';
                                                         if(fieldVal != undefined)
                                                             actval = fieldVal;
                                                         // Added by Sanjay 1/18/2016
                                                         // show email field as link
                                                         if(recIdKeyPrefix == '005' && this.fieldList[fi]['Field_API_Name__c'] == 'Email'){
                                                             fldContent = '<a  href="mailto:'+actval+'">'+actval+'</a>';
                                                         }else{
                                                             fldContent = $('<div/>').html(actval).text();
                                                         } 
                                                         
                                                         // Convert string in to Rich Text.
                                                         htmlstr +='<td><div class=wordwrap>'+ fldContent +'</div></td>';
                                                     }
                                                 } 
                                             }else{
                                                 // If no returning field just show single column - Id
                                                 htmlstr +='<td><div>'+this.sObjList[i]['Id']+'</div></td>';
                                             }     
                                             htmlstr += '</tr>' ;
                                         }  
                                         htmlstr += '</tbody></table> ';
                                         htmlstr =   htmlstr+ '</div>'+
                                                     '</div>'; 
                                     }    
                                     
                                    
                                });
                                if(recFoundFlag==false){
                                    $("#msg").html('<div class="alert alert-info" role="alert">No Matches Found.</div>');
                                }
                                 // Add dynamically generated html content to searchResult Section    
                                $("#searchResult").append(htmlstr);
                                //Use datatable plugin 
                                $("table.searchRecordTable").DataTable();
                                //Hide loading panel when search complets. 
                                $('#Searching_Modal').modal('hide');
                                    
                                }else{
                                     document.getElementById("msg").innerHTML = '<div class="alert alert-danger" role="alert">Search Object Not Defined.</div>';
                                     $('#Searching_Modal').modal('hide');
                                }    
                            } else {
                                document.getElementById("msg").innerHTML = '<div class="alert alert-danger" role="alert">Error: '+event.message+'</div>';
                                $('#Searching_Modal').modal('hide');
                            }
                        }, 
                        {escape: true}
                    );
                }
                
                // method executes when user click on clear filter links
                $('#clrFltr').click(function(){
                    $('input:checkbox').removeAttr('checked');
                    document.getElementById('page:form:inpf').value = '';
                    document.getElementById('page:form:contStr').value = '';
                    startSearching();
                });
                
                // Select-deselect, Content type and file Type check box in search panel  
                function toggleRtypeCheck(element, className){
                    var elemts = document.getElementsByClassName(className);
                    for(var s= 0; s<elemts.length; s++){
                        elemts[s].checked = element.checked;
                    }
                }
                function checkParent(element, parentelementId){
                    var elemt = document.getElementById(parentelementId);
                    if(element.checked){
                        elemt.checked = element.checked;
                    }
                }
                    
              
        </script>
      
         <c:COH_SIP_Footer ></c:COH_SIP_Footer>   
                </apex:form>
            </div>
    </body>    
    
</html> 
    
      
</apex:page>